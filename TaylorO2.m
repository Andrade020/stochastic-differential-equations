%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LUCAS ANDRADE %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%%%%% hiperparametros %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
T = 2;             % X final
N = 1000;          % Npassos
dt = T/N;          % h
M = 10000;         % qttd de Monte Carlos 
X2 = zeros(M, 1); % abrindo array
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%% Monte Carlo%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
for j = 1:M
    Y = 0.5;  % Valor inicial
    for i = 1:N
        dW = sqrt(dt) * randn;  % Incremento do Browniano
        a = -Y * (1 - Y^2);
        b = 1 - Y^2;
        ap = -1 + 3 * Y^2;
        bp = -2 * Y;
        bpp = -2;

        % Taylor de Ordem 2, descrito na Acta Num√©rica e na minha prova 
        Y = Y + a * dt + b * dW + b * bp * (dW^2 - dt) + b * ap * dW * dt + ...
            (a * bp + 0.5 * b^2 * bpp) * dW + ...
            (a * ap + 0.5 * b^2 * ap) * dt^2 / 2;
    end
    X2(j) = Y^2;  % Armazenar o quadrado do valor final
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Calcula media %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
E_X2 = mean(X2);
disp(['E(X^2(2)) = ', num2str(E_X2)]);  % printa
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%